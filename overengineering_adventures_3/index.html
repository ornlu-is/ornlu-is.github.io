<!doctype html><html lang=en><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-G300HG9GRT"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-G300HG9GRT")</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Adventures in Overengineering 3: manning the Helm - Luís Franco</title><meta name=Description content="Using helm on a local Kubernetes cluster"><meta property="og:title" content="Adventures in Overengineering 3: manning the Helm"><meta property="og:description" content="Using helm on a local Kubernetes cluster"><meta property="og:type" content="article"><meta property="og:url" content="https://ornlu-is.github.io/overengineering_adventures_3/"><meta property="og:image" content="https://ornlu-is.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-26T23:35:24+01:00"><meta property="article:modified_time" content="2023-03-27T11:16:16+01:00"><meta property="og:site_name" content="Super website"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ornlu-is.github.io/logo.png"><meta name=twitter:title content="Adventures in Overengineering 3: manning the Helm"><meta name=twitter:description content="Using helm on a local Kubernetes cluster"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://ornlu-is.github.io/overengineering_adventures_3/><link rel=prev href=https://ornlu-is.github.io/overengineering_adventures_2/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Adventures in Overengineering 3: manning the Helm","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/ornlu-is.github.io\/overengineering_adventures_3\/"},"genre":"posts","wordcount":2295,"url":"https:\/\/ornlu-is.github.io\/overengineering_adventures_3\/","datePublished":"2023-03-26T23:35:24+01:00","dateModified":"2023-03-27T11:16:16+01:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Luís Franco"},"description":"Using helm on a local Kubernetes cluster"}</script></head><body data-header-desktop=auto data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Luís Franco">Luís Franco</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></span></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Luís Franco">Luís Franco</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Adventures in Overengineering 3: manning the Helm</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Luís Franco</a>
</span>&nbsp;<span class=post-category>included in <a href=/categories/adventures-in-overengineering/><i class="far fa-folder fa-fw" aria-hidden=true></i>Adventures in Overengineering</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-03-26>2023-03-26</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;2295 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;11 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#what-is-this-helm-do-i-look-like-a-sailor-to-you>What is this &ldquo;Helm&rdquo;? Do I look like a sailor to you?</a></li><li><a href=#setting-sails-with-helm>Setting sails with Helm</a></li><li><a href=#swab-the-projects-structure>Swab the project&rsquo;s structure</a></li><li><a href=#land-ho-deploy-app>Land ho! Deploy app!</a></li></ul></nav></div></div><div class=content id=content><p>Ahoy! It&rsquo;s time to include Helm in our project! Why? Three reasons: making our life easier when it comes to managing Kubernetes resources, staying true to the overengineering game by introducing yet another tool, and will also allow me to write more pirate related puns than what should be legally allowed. I apologize in advance for my terrible sense of humour. It is recommended to read this post while listening to &ldquo;Under Jolly Roger&rdquo; by Running Wild or any other pirate song.</p><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>Link to the code<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><a href=https://github.com/ornlu-is/askeladden/tree/v0.3 target=_blank rel="noopener noreffer">https://github.com/ornlu-is/askeladden/tree/v0.3</a></div></div></div><h2 id=what-is-this-helm-do-i-look-like-a-sailor-to-you>What is this &ldquo;Helm&rdquo;? Do I look like a sailor to you?</h2><p>First, a fun fact. The name Kubernetes stands for &ldquo;helmsman&rdquo; or &ldquo;pilot&rdquo; in Greek, and its logo is actually a helm (I cannot believe I missed this before), which justifies the naming choice for the tool we are about to introduce into the project. Helm is basically a package manager for Kubernetes, and works through specification of charts (this is not a pun, this their the actual name). In this context, a chart is simply a collection of files that describe a related set of Kubernetes resources. Using this tool yields the following advantages:</p><ul><li>Reduces the complexity of deployments since Kubernetes requires resources to be created in a given order and Helm takes care of that for us;</li><li>Reproducible deployments, since a Helm guarantees that what is in the chart matches the configuration in the Kubernetes cluster;</li><li>Easier to rollback to previous deployments since Helm maintains a comprehensive revision history;</li><li>Allows us to sail under the Jolly Roger.</li></ul><p>With all this in mind, let&rsquo;s begin adapting our project to support Helm!</p><h2 id=setting-sails-with-helm>Setting sails with Helm</h2><p>First, let us look at our current directory tree. We can do this by running the <code>tree</code> command in our root directory, which outputs the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── Dockerfile
</span></span><span class=line><span class=cl>├── go.mod
</span></span><span class=line><span class=cl>├── k8s
</span></span><span class=line><span class=cl>│   ├── deployment.yaml
</span></span><span class=line><span class=cl>│   ├── namespace.yaml
</span></span><span class=line><span class=cl>│   └── service.yaml
</span></span><span class=line><span class=cl>├── main.go
</span></span><span class=line><span class=cl>└── README.md
</span></span></code></pre></td></tr></table></div></div><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden=true></i>tree<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>You have to install <code>tree</code> since it is not shipped with most operating systems. If, like me, you are running Ubuntu, you can install it using <code>sudo apt install tree</code>.</div></div></div><p>I want to use Helm uniquely to control the deployment of my web server (in case you haven&rsquo;t read my previous posts, this is an incredible web server that simply prints a Monty Python quote). The first step is to create our Helm chart. For that matter, we have to create the following directories and files in our project&rsquo;s root directory:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>chart
</span></span><span class=line><span class=cl>└── askeladden
</span></span><span class=line><span class=cl>    ├── Chart.yaml
</span></span><span class=line><span class=cl>    ├── templates
</span></span><span class=line><span class=cl>    │   ├── deployment.yaml
</span></span><span class=line><span class=cl>    │   ├── _helpers.tpl
</span></span><span class=line><span class=cl>    │   └── service.yaml
</span></span><span class=line><span class=cl>    └── values.yaml
</span></span></code></pre></td></tr></table></div></div><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>helm create chart<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Alternatively, we could&rsquo;ve used <code>helm create chart</code> which would create the Helm chart for Nginx, but then we&rsquo;d have to delete several of the files and most of their content, so it is easier to create the files manually, since this implies less keystrokes and, in turn, a longer finger joint lifetime.</div></div></div><p>These are almost as many files as what we already had in our project, so it is worth going over their purpose one by one:</p><ul><li><code>Chart.yaml</code> - metadata on the chart itself;</li><li><code>values.yaml</code> - contains the default values for our chart that will be injected by Helm into the templates;</li><li><code>templates/_helpers.tpl</code> - contains utilities to be used across templates;</li><li><code>templates/deployment.yaml</code> - this will be the template for our Kubernetes deployment;</li><li><code>templates/service.yaml</code> - and this will be the template for our Kubernetes service.</li></ul><p>We can already fill out the contents of <code>Chart.yaml</code> with the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>askeladden</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>A web server that barely does anything</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>0.0.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>appVersion</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.3&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Where each field has the following function:</p><ul><li><code>apiVersion</code> specifies the Helm version we are using;</li><li><code>name</code> is the name of the chart. Here I named it the same as our application because naming things is hard;</li><li><code>description</code> is self-explanatory;</li><li><code>version</code> is the chart version;</li><li><code>appVersion</code> is the application version, which is &ldquo;0.0.3&rdquo; since this is the third post in the series.</li></ul><p>However, for the remaining files, it is required that we use <a href=https://pkg.go.dev/text/template target=_blank rel="noopener noreffer">yo-ho-Golang&rsquo;s template syntax</a>
, since is that is what confers Helm its flexibility. We have a bunch of repeated fields in our Kubernetes files such as the labels used for the <code>matchSelector</code> or the <code>name</code>, and we have some values that can be seen as overall configuration values and, as such, should be in the <code>values.yaml</code> file to be injected into the Kubernetes definition files by Helm. The objective is to have helm output a Kubernetes manifest that matches exactly what we previously had. Let us begin by writing the following into our <code>values.yaml</code> file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>replicaCount</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>localhost:32000/askeladden:slim</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>askeladden</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>selectorLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>askeladden</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deploymentLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class=l>dev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8090</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30008</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Then, let us define our helpers. These are simple reusable Go template shortcodes that can be used to improve readability of the templates. We have defined three different label dictionaries in our <code>values.yaml</code>, so let us create helpers that will fill the templates with the values of these dictionaries. Thus, our <code>_helper.tpl</code> has the following content:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-tpl data-lang=tpl><span class=line><span class=cl><span class=cp>{{</span><span class=o>/*</span>
</span></span><span class=line><span class=cl><span class=na>Get</span> <span class=na>the</span> <span class=na>selector</span> <span class=na>labels</span> <span class=na>dictionary</span>
</span></span><span class=line><span class=cl><span class=o>*/</span><span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=na>define</span> <span class=s2>&#34;chart.selectorLabels&#34;</span> <span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=na>range</span> <span class=nv>$key</span><span class=o>,</span><span class=nv>$value</span> <span class=o>:=</span> <span class=o>.</span><span class=na>Values</span><span class=o>.</span><span class=na>selectorLabels</span> <span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=nv>$key</span> <span class=cp>}}</span><span class=x>: </span><span class=cp>{{</span> <span class=nv>$value</span> <span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=na>end</span><span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=na>end</span> <span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>/*</span>
</span></span><span class=line><span class=cl><span class=na>Get</span> <span class=na>the</span> <span class=na>labels</span> <span class=na>dictionary</span>
</span></span><span class=line><span class=cl><span class=o>*/</span><span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=na>define</span> <span class=s2>&#34;chart.labels&#34;</span> <span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=na>range</span> <span class=nv>$key</span><span class=o>,</span><span class=nv>$value</span> <span class=o>:=</span> <span class=o>.</span><span class=na>Values</span><span class=o>.</span><span class=na>labels</span> <span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=nv>$key</span> <span class=cp>}}</span><span class=x>: </span><span class=cp>{{</span> <span class=nv>$value</span> <span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=na>end</span><span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=na>end</span> <span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>/*</span>
</span></span><span class=line><span class=cl><span class=na>Get</span> <span class=na>the</span> <span class=na>deployment</span> <span class=na>labels</span> <span class=na>dictionary</span>
</span></span><span class=line><span class=cl><span class=o>*/</span><span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=na>define</span> <span class=s2>&#34;chart.deploymentLabels&#34;</span> <span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=na>range</span> <span class=nv>$key</span><span class=o>,</span><span class=nv>$value</span> <span class=o>:=</span> <span class=o>.</span><span class=na>Values</span><span class=o>.</span><span class=na>labels</span> <span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=nv>$key</span> <span class=cp>}}</span><span class=x>: </span><span class=cp>{{</span> <span class=nv>$value</span> <span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=na>end</span><span class=cp>}}</span><span class=x>
</span></span></span><span class=line><span class=cl><span class=x></span><span class=cp>{{</span><span class=o>-</span> <span class=na>end</span> <span class=cp>}}</span><span class=x>
</span></span></span></code></pre></td></tr></table></div></div><p>Now, if we want to call any of the helpers we defined, we would use, for example <code>{{- include "chart.labels" . }}</code>, where <code>.</code> represents the object that contains all the information in the <code>values.yaml</code> file. Using the helpers, we get the following service template:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>.Chart.Name }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{{- <span class=l>include &#34;chart.labels&#34; . | nindent 4 }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>.Values.service.type }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>.Values.service.port }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>.Values.service.targetPort }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>.Values.service.nodePort }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{{- <span class=l>include &#34;chart.selectorLabels&#34; . | nindent 6 }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Note that there is a subtle difference between specifying <code>{{ .... }}</code> and <code>{{- ... }}</code>: the latter will remove all trailing whitespace, while the former will not. That is why we pipe the results of the helpers&rsquo; calls into <code>nindent</code>, so that we can specify the indentation in a more taylored fashion. Following the same paradigm, we get the deployment template below:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>.Chart.Name }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{{- <span class=l>include &#34;chart.deploymentLabels&#34; . | nindent 4 }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>.Values.replicaCount }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>{{- <span class=l>include &#34;chart.selectorLabels&#34; . | nindent 6 }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>{{- <span class=l>include &#34;chart.selectorLabels&#34; . | nindent 8 }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>.Chart.Name }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>.Values.image }}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>To check if we have done everything properly and that we have a valid YAML file, we can run <code>helm template chart/askeladden</code>, which outputs:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Source: askeladden/templates/service.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>askeladden</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>askeladden</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8090</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30008</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>askeladden</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Source: askeladden/templates/deployment.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>askeladden</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>askeladden</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>askeladden</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>askeladden</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>askeladden</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>localhost:32000/askeladden:slim</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Since we had no error messages, we have a YAML file, which is great! Note that if did have any errors, we would only see the error message in the terminal, without the rendered Kubernetes manifest. In that case, to see what is wrong with the manifest, we would add the <code>--debug</code> flag to the aforementioned command, which will print the rendered manifest along with the detected errors.</p><h2 id=swab-the-projects-structure>Swab the project&rsquo;s structure</h2><p>Notice that we had three Kubernetes resource definition files but we left one of them out of our Helm chart. This is because the namespace is not a part of our web server, but a part of our cluster, and, as such, we want to keep it out of our chart. For that matter, we will create an <code>infrastructure</code> directory which will in turn have a <code>k8s</code> directory and we will place our <code>namespace.yaml</code> file there. Then, we create a <code>services/askeladden</code> directory and place the remaining contents there, except the <code>go.mod</code> file. I am a big fan of documenting stuff properly (as this blog highlights), so I also created a <code>README.md</code> for the <code>askeladden</code> service. Our directory tree ends up as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>askeladden/
</span></span><span class=line><span class=cl>├── go.mod
</span></span><span class=line><span class=cl>├── infrastructure
</span></span><span class=line><span class=cl>│   └── k8s
</span></span><span class=line><span class=cl>│       └── namespace.yaml
</span></span><span class=line><span class=cl>├── README.md
</span></span><span class=line><span class=cl>└── services
</span></span><span class=line><span class=cl>    └── askeladden
</span></span><span class=line><span class=cl>        ├── chart
</span></span><span class=line><span class=cl>        │   └── askeladden
</span></span><span class=line><span class=cl>        │       ├── Chart.yaml
</span></span><span class=line><span class=cl>        │       ├── templates
</span></span><span class=line><span class=cl>        │       │   ├── deployment.yaml
</span></span><span class=line><span class=cl>        │       │   ├── _helpers.tpl
</span></span><span class=line><span class=cl>        │       │   └── service.yaml
</span></span><span class=line><span class=cl>        │       └── values.yaml
</span></span><span class=line><span class=cl>        ├── Dockerfile
</span></span><span class=line><span class=cl>        ├── main.go
</span></span><span class=line><span class=cl>        └── README.md
</span></span></code></pre></td></tr></table></div></div><h2 id=land-ho-deploy-app>Land ho! Deploy app!</h2><p>Now we need to use Helm to deploy our service! We can see that our service is still running if we run <code>mk get all</code>, we get the following output:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>NAME                                             READY   STATUS    RESTARTS       AGE
</span></span><span class=line><span class=cl>pod/deployment-askeladden-dev-6b766588c5-hkn2x   1/1     Running   3 (139m ago)   5d11h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                             TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
</span></span><span class=line><span class=cl>service/askeladden-dev-service   NodePort   10.152.183.55   &lt;none&gt;        80:30008/TCP   11d
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                        READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/deployment-askeladden-dev   1/1     1            1           11d
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                                   DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/deployment-askeladden-dev-6b766588c5   1         1         1       5d11h
</span></span><span class=line><span class=cl>replicaset.apps/deployment-askeladden-dev-75c45dc7d9   0         0         0       11d
</span></span></code></pre></td></tr></table></div></div><p>There is something odd, we have our first ever replica set still hanging around. Kubernetes keeps old replica sets around because that is what it uses in case we need to rollback our deployment. However, we are now using Helm, so we do not need that anymore, since Helm has its own revision history. Let us delete our deployment with <code>mk delete deployment.apps/deployment-askeladden-dev</code>.</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>mk delete deployment.apps/deployment-askeladden-dev<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>We would usually have to write this command in the <code>mk delete &lt;resource_type> &lt;resource_name></code>. However, since we are passing the <code>delete</code> command the name of the deployment in the <code>&lt;resource_type>/&lt;resource_name></code> format, we only require one argument for the command.</div></div></div><p>Similarly, we will delete our service with <code>mk delete service/askeladden-dev-service</code>. Running <code>mk get all</code> now shows that we have no resources in our namespace:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>No resources found in askeladden-dev namespace.
</span></span></code></pre></td></tr></table></div></div><p>We are good to go to use Helm now! However, just to be on the safe side of things, we want to test our chart a bit more. We already know that it is a valid YAML file, so now we want to know if it generates any possible errors in our Kubernetes cluster. For that matter, we can use the following command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>microk8s helm install askeladden chart/askeladden --dry-run
</span></span></code></pre></td></tr></table></div></div><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>microk8s helm install askeladden chart/askeladden --dry-run<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>The <code>helm install &lt;name> &lt;chart_path></code> command install a given chart on the cluster with the given name. The trick here is the <code>--dry-run</code> flag, which validates the manifests by communicating with the Kubernetes cluster. Pretty neat!</div></div></div><p>This command outputs the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>NAME: askeladden
</span></span><span class=line><span class=cl>LAST DEPLOYED: Mon Mar 26 11:02:41 2023
</span></span><span class=line><span class=cl>NAMESPACE: askeladden-dev
</span></span><span class=line><span class=cl>STATUS: pending-install
</span></span><span class=line><span class=cl>REVISION: 1
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>HOOKS:
</span></span><span class=line><span class=cl>MANIFEST:
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl># Source: askeladden/templates/service.yaml
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Service
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: askeladden
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    app: askeladden
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  type: NodePort
</span></span><span class=line><span class=cl>  ports:
</span></span><span class=line><span class=cl>  - port: 80
</span></span><span class=line><span class=cl>    targetPort: 8090
</span></span><span class=line><span class=cl>    nodePort: 30008
</span></span><span class=line><span class=cl>    protocol: TCP
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>      app: askeladden
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl># Source: askeladden/templates/deployment.yaml
</span></span><span class=line><span class=cl>apiVersion: apps/v1
</span></span><span class=line><span class=cl>kind: Deployment
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: askeladden
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    app: askeladden
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  replicas: 1
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    matchLabels:
</span></span><span class=line><span class=cl>      app: askeladden
</span></span><span class=line><span class=cl>  template:
</span></span><span class=line><span class=cl>    metadata:
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        app: askeladden
</span></span><span class=line><span class=cl>    spec:
</span></span><span class=line><span class=cl>      containers:
</span></span><span class=line><span class=cl>      - name: askeladden
</span></span><span class=line><span class=cl>        image: localhost:32000/askeladden:slim
</span></span></code></pre></td></tr></table></div></div><p>Everything seems in order, meaning that we can board the ship and deploy by running the same command without the <code>--dry-run</code> flag.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>NAME: askeladden
</span></span><span class=line><span class=cl>LAST DEPLOYED: Mon Mar 26 11:03:41 2023
</span></span><span class=line><span class=cl>NAMESPACE: askeladden-dev
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 1
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span></code></pre></td></tr></table></div></div><p>No error messages seems like a good sign. Let us check if we have any Kubernetes resources on our namespace with <code>mk get all</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>NAME                              READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/askeladden-6b766588c5-xjm7t   1/1     Running   0          6s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                 TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
</span></span><span class=line><span class=cl>service/askeladden   NodePort   10.152.183.151   &lt;none&gt;        80:30008/TCP   6s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                         READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/askeladden   1/1     1            1           6s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                    DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/askeladden-6b766588c5   1         1         1       6s
</span></span></code></pre></td></tr></table></div></div><p>All the necessary resources have been create, meaning that we have only one validation step left: navigating to <code>http://localhost:30008/</code>. Opening the browser with that link shows the following message:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>Strange women lying in ponds distributing swords is no basis for a system of government.
</span></span></code></pre></td></tr></table></div></div><p>We have successfully converted our Kubernetes configurations files into a Helm chart and deployed it without any hassle! We can now peacefully set sails to the next overengineering adventure!</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-03-27</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/overengineering_adventures_2/ class=prev rel=prev title="Adventures in Overengineering 2: a better Docker image"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Adventures in Overengineering 2: a better Docker image</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Luís Franco</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>