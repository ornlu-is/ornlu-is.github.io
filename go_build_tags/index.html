<!doctype html><html lang=en><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-G300HG9GRT"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-G300HG9GRT")</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Using Go build tags for defining sets of tests - Luís Franco</title><meta name=Description content="How to use Go build tags to separate unit tests from integration or functional tests"><meta property="og:title" content="Using Go build tags for defining sets of tests">
<meta property="og:description" content="How to use Go build tags to separate unit tests from integration or functional tests"><meta property="og:type" content="article"><meta property="og:url" content="https://ornlu-is.github.io/go_build_tags/"><meta property="og:image" content="https://ornlu-is.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-16T21:37:47+01:00"><meta property="article:modified_time" content="2023-08-16T22:41:08+01:00"><meta property="og:site_name" content="Super website"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ornlu-is.github.io/logo.png"><meta name=twitter:title content="Using Go build tags for defining sets of tests"><meta name=twitter:description content="How to use Go build tags to separate unit tests from integration or functional tests"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://ornlu-is.github.io/go_build_tags/><link rel=prev href=https://ornlu-is.github.io/kubernetes_deploy_job_failed_but_my_service_was_deployed/><link rel=next href=https://ornlu-is.github.io/go_design_pattern_generator/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Using Go build tags for defining sets of tests","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/ornlu-is.github.io\/go_build_tags\/"},"genre":"posts","wordcount":683,"url":"https:\/\/ornlu-is.github.io\/go_build_tags\/","datePublished":"2023-08-16T21:37:47+01:00","dateModified":"2023-08-16T22:41:08+01:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Luís Franco"},"description":"How to use Go build tags to separate unit tests from integration or functional tests"}</script></head><body data-header-desktop=auto data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Luís Franco">Luís Franco</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></span></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Luís Franco">Luís Franco</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Using Go build tags for defining sets of tests</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Luís Franco</a>
</span>&nbsp;<span class=post-category>included in <a href=/categories/golang/><i class="far fa-folder fa-fw" aria-hidden=true></i>Golang</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-08-16>2023-08-16</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;683 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#what-are-build-tags-in-go>What are build tags in Go?</a></li><li><a href=#build-tag-boolean-logic>Build tag boolean logic</a></li><li><a href=#how-can-these-be-used-for-testing>How can these be used for testing?</a></li></ul></nav></div></div><div class=content id=content><p>Some time ago, I was looking for a way to define a clear separation in a Go project between my unit tests and my integration tests. At the time, the solution I came up with involved creating a submodule and some Makefile shenanigans to separate these into two sets. I was unhappy with this approach, since it ended up being convoluted and prone to error as the code base evolved. However, today I recently learned about Go&rsquo;s build tags that seemlessly allow me to separate my integration tests from my unit tests.</p><h2 id=what-are-build-tags-in-go>What are build tags in Go?</h2><p>Build tags are used by the Go compiler to know when and which code needs to be compiled. While some people use this when developing software that might have features enabled for a given operating system, <em>e.g.</em>, Windows 10 vs. some Linux distro, but have not yet been implemented into other OSs. To add a build tag to a specific <code>.go</code> file, all you have to do is add the following magic comment to the top of the file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// +build &lt;your tag goes here&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nx>something</span>
</span></span></code></pre></td></tr></table></div></div><p>Note that an empty line was added after the build tag. This is not by accident, it is by design: if you forget to add the newline after the build tag, the Go compiler will interpret it as a comment instead, rendering your build tag useless.</p><p>If you specified a build tag, say <code>tagus</code>, on some <code>.go</code> file, and you then run <code>go build</code>, that tagged file will not be compiled, build tags exclude your code from being compiled as their default behaviour. To include tagged files when compiling you simply have to add the <code>-tags</code> flag followed by the tags to add, as shown below:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>go build -tags tagus
</span></span></code></pre></td></tr></table></div></div><p>Files without any built tag are compiled irrespective of what tags you specify to the <code>go build</code> command.</p><h2 id=build-tag-boolean-logic>Build tag boolean logic</h2><p>You probably noticed that the flag we just used was a plural noun, and you are likely thinking that this must mean we can specify several tags when compiling. You are very much correct. Moreover, build tags in Go allow for, albeit limited, boolean logic. Three boolean operations are allowed with build tags:</p><ul><li>OR - by separating tags with a space: <code>// +build one two</code></li><li>AND - by separating tags with a comma: <code>// +build one,two</code></li><li>NOT - by prefixing tags with an exclamation mark: <code>// +build !one</code></li></ul><h2 id=how-can-these-be-used-for-testing>How can these be used for testing?</h2><p>When you run Go tests using <code>go test</code>, you are actually compiling the code in your <code>_test.go</code> files, as well as any code used, directly or indirectly, by these files. Then the resulting binary is ran, your test output is produced, and then the binary is deleted (although there is some caching going on to build the test binary faster the next time you run <code>go test</code>).</p><p>If it compiles, then surely it can also make use of build tags. In the beginning of this blog post, I said I used this to separate unit from integration tests. The first question you might want to ask is why I want to do that. The main reason is because unit tests are fast, but integration tests tend to be very slow. In my case, my unit tests only need to build the test binary, while my integration tests require a Docker Compose stack to be built and started, which is a bit cumbersome when you are writing code that can be easily covered by unit tests.</p><p>As such, on my <code>integration_test.go</code> file, I added a simple build tag, via <code>// +build integration</code>, and then I added the following two Makefile targets:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Makefile data-lang=Makefile><span class=line><span class=cl><span class=nf>integration-tests</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    go <span class=nb>test</span> -tags integration -v ./...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>unit-tests</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    go <span class=nb>test</span> -v ./...
</span></span></code></pre></td></tr></table></div></div><p>This means that, to only run unit tests, <code>make unit-tests</code> is the way to go. However, if I want to run all of my tests, including integration tests, I can simply call <code>make integration-tests</code> and go grab a cup of coffee because my integration tests stack takes forever to run.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-08-16</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/kubernetes_deploy_job_failed_but_my_service_was_deployed/ class=prev rel=prev title="Kubernetes deploy job failed but the service was deployed"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Kubernetes deploy job failed but the service was deployed</a>
<a href=/go_design_pattern_generator/ class=next rel=next title="Go Design Patterns: Generator">Go Design Patterns: Generator<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Luís Franco</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>